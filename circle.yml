machine:
  php:
    version: 5.6.18
  node:
    version: 4.2.6
  environment:
    # This is where we build our complete Drupal site
    DRUPAL_SITE_PATH: /tmp/drupal

dependencies:
  pre:
    - echo "memory_limit = 512M" > /opt/circleci/php/$(phpenv global)/etc/conf.d/memory.ini

    # Disable mail sending. Sendmail is not working on Circle.
    - echo "sendmail_path = /bin/true" > /opt/circleci/php/$(phpenv global)/etc/conf.d/sendmail.ini

    # Clean up existing global composer installation. It contains dependencies
    # which do not match the PHP version we use. This prevents installation of
    # other packages.
    - rm -rf ~/.composer/vendor

    # Install drush.
    - composer global require drush/drush:8.1.* --prefer-source --no-interaction

    - mkdir -p /opt/behat
    - cd /opt/behat
    - cat >> $settingsFile <<'EOF'
{
  "require": {
    "drupal/drupal-extension": "~3.0"
},
  "config": {
    "bin-dir": "bin/"
  }
}
EOF
    - composer install
    - ln -s /opt/drupalextension/bin/behat /usr/local/bin/behat

test:
  override:
    # Install the site
    - composer install

    # Test that sass was compiled.
    ## Needs to disable browser sync.

    # Run site install
    - (cd profiles/itkore/behat-tests/ && behat -f pretty)

  post:
